<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nooscope Trends</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .tab-content {
            margin-top: 20px;
        }
        .table th {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Nooscope Trends</h1>
        <ul class="nav nav-tabs" id="sourceTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="rss-tab" data-bs-toggle="tab" data-bs-target="#rss" type="button" role="tab">RSS Feeds</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="google-tab" data-bs-toggle="tab" data-bs-target="#google" type="button" role="tab">Google Trends</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reddit-tab" data-bs-toggle="tab" data-bs-target="#reddit" type="button" role="tab">Reddit Trends</button>
            </li>
        </ul>
        <div class="tab-content" id="sourceTabsContent">
            <!-- RSS Feeds -->
            <div class="tab-pane fade show active" id="rss" role="tabpanel" aria-labelledby="rss-tab">
                <h2>RSS Feeds</h2>
                <input type="text" class="form-control mb-3" id="rssSearch" placeholder="Search RSS Feeds">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th onclick="sortTable('rssTable', 0)">Topic</th>
                            <th onclick="sortTable('rssTable', 1)">Sentiment</th>
                            <th onclick="sortTable('rssTable', 2)">Date</th>
                        </tr>
                    </thead>
                    <tbody id="rssTable">
                        {% for trend in rss_data %}
                        <tr>
                            <td>{{ trend[0] }}</td>
                            <td>{{ trend[1] | round(2) }}</td>
                            <td>{{ trend[2] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="mt-4">
                    <canvas id="rssChart"></canvas>
                </div>
            </div>
            <!-- Google Trends -->
            <div class="tab-pane fade" id="google" role="tabpanel" aria-labelledby="google-tab">
                <h2>Google Trends</h2>
                <input type="text" class="form-control mb-3" id="googleSearch" placeholder="Search Google Trends">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th onclick="sortTable('googleTable', 0)">Topic</th>
                            <th onclick="sortTable('googleTable', 1)">Sentiment</th>
                            <th onclick="sortTable('googleTable', 2)">Date</th>
                        </tr>
                    </thead>
                    <tbody id="googleTable">
                        {% for trend in google_data %}
                        <tr>
                            <td>{{ trend[0] }}</td>
                            <td>{{ trend[1] | round(2) }}</td>
                            <td>{{ trend[2] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="mt-4">
                    <canvas id="googleChart"></canvas>
                </div>
            </div>
            <!-- Reddit Trends -->
            <div class="tab-pane fade" id="reddit" role="tabpanel" aria-labelledby="reddit-tab">
                <h2>Reddit Trends</h2>
                <input type="text" class="form-control mb-3" id="redditSearch" placeholder="Search Reddit Trends">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th onclick="sortTable('redditTable', 0)">Topic</th>
                            <th onclick="sortTable('redditTable', 1)">Sentiment</th>
                            <th onclick="sortTable('redditTable', 2)">Date</th>
                        </tr>
                    </thead>
                    <tbody id="redditTable">
                        {% for trend in reddit_data %}
                        <tr>
                            <td>{{ trend[0] }}</td>
                            <td>{{ trend[1] | round(2) }}</td>
                            <td>{{ trend[2] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="mt-4">
                    <canvas id="redditChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Search functionality
        document.querySelectorAll('input[type="text"]').forEach(input => {
            input.addEventListener('input', function () {
                const filter = this.value.toUpperCase();
                const rows = document.querySelectorAll(`#${this.id.replace('Search', 'Table')} tr`);
                rows.forEach(row => {
                    const cells = row.getElementsByTagName('td');
                    const match = Array.from(cells).some(cell => cell.textContent.toUpperCase().includes(filter));
                    row.style.display = match ? '' : 'none';
                });
            });
        });

        // Sort table functionality
        function sortTable(tableId, colIndex) {
            const table = document.getElementById(tableId);
            const rows = Array.from(table.rows);
            rows.sort((a, b) => {
                const aText = a.cells[colIndex].textContent;
                const bText = b.cells[colIndex].textContent;
                return isNaN(aText - bText) ? aText.localeCompare(bText) : aText - bText;
            });
            rows.forEach(row => table.appendChild(row));
        }

        // Графики для каждой вкладки
        const createChart = (chartId, data, labels) => {
            const ctx = document.getElementById(chartId).getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sentiment',
                        data: data,
                        backgroundColor: data.map(value => value > 0 ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)'),
                        borderColor: data.map(value => value > 0 ? 'rgba(75, 192, 192, 1)' : 'rgba(255, 99, 132, 1)'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Sentiment Analysis' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        };

        // Данные для графиков
        const rssData = [{% for trend in rss_data %}{{ trend[1] }},{% endfor %}];
        const googleData = [{% for trend in google_data %}{{ trend[1] }},{% endfor %}];
        const redditData = [{% for trend in reddit_data %}{{ trend[1] }},{% endfor %}];
        const labels = [{% for trend in rss_data %}"{{ trend[0] }}",{% endfor %}];

        // Создаём графики
        createChart('rssChart', rssData, labels);
        createChart('googleChart', googleData, labels);
        createChart('redditChart', redditData, labels);
    </script>
</body>
</html>
